---
title: 'Clase 2: descripción y visualización'
author: "Arturo Maldonado"
date: "22/8/2023"
output:
  html_document:
    toc: true
    toc_float: true
    collapsed: false
    number_sections: false
    toc_depth: 1
    code_download: true
    theme: cosmo
    highlight: textmate
editor_options:
  markdown:
    wrap: sentence
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

------------------------------------------------------------------------

# Resultados electorales 2016

## Leer una base de datos

Usamos la librería `rio`.
Activamos la librería con el comando `library` y usamos el comando `import` para leer la base de datos (un archivo Excel).
Ojo: el nombre del archivo tiene que estar entre comillas.
En este caso, el archivo está dentro de mi directorio de trabajo, por lo que se le llama con el nombre.
Si no estuviera en el directorio de trabajo se tendría que especificar la ruta del archivo.

Guardamos esta base de datos en un nuevo objeto (dataframe) llamado res2016.
Se sugiere siempre trabajar con nombres cortos de bases de datos y de variables.

Van a poder escribir

```{r message=FALSE, warning=FALSE}
library(rio)
res2016 = import("resultados2016.xlsx")
```

Si se hace doble click en el objeto, se abre la base de datos como una pestaña en la zona de scripts / RMarkdowns.
Este objeto dataframe tiene vectores de datos de tipo "caracter" y otros vectores de datos de tipo "numérico".

## Descripción

Usamos las medidas de tendencia central para describir una variable numérica.
Podemos usar el comando `mean` para calcular el promedio de voto provincial a Fuerza Popular en 2016 (39.5%).
Este comando asume que se tienen datos completos.
Si existiera un dato perdido, el comando no correría, y se tendría que añadir la especificación `, na.rm = T`.
También se puede calcular la mediana, con el comando `median`.

Se observa que ambas medidas son aproximadamente iguales, indicando una distribución simétrica de datos.

```{r}
library(dplyr)
library(tidyverse)
res2016 |>
  summarise(mean(fp))
```

También se puede calcular la media para grupos de observaciones, es decir para filas específicas de una base de datos.
Por ejemplo, si quisiéramos saber si el voto en las provincias de Lima fue mayor o menor que el voto provincial general de Fuerza Popular, podríamos calcular la media del voto provincial solo en las provincias de Lima.

Esto se puede hacer de múltiples maneras.
En este curso comenzaremos a usar las funciones del mundo del Tidyverse.

En cualquier caso, se tiene que seleccionar algunas filas de un dataframe usando operadores lógicos.
En R tenemos los siguientes operadores lógicos:

| Operador |    Descripción     |
|:--------:|:------------------:|
|    ==    |     es igual a     |
|    !=    |  es diferente de   |
|    \>    |    es mayor de     |
|    \<    |    es menor de     |
|   \>=    | es mayor o igual a |
|   \<=    | es menor o igual a |
|    &     |  intersección (Y)  |
|    \|    |     unión (O)      |

En nuestro caso vamos a seleccionar las observaciones que en el vector o variable "dpto" sean igual a "LIMA".
Ojo, en mayúsculas, dado que así está en la base de datos y entre comillas porque es una cadena de caracteres.

```{r}
res2016 |> 
  filter(dpto =="LIMA") |>
  summarise(mean(fp))
#Cómo hallarían el promedio del voto a FP en las provincias de Amazonas usando la variable "id"?
```

Encontramos que en Lima el promedio provincial de voto a Fuerza Popular es mayor que el promedio provincial general.

Para el caso de la votación al Frente Amplio, calculamos la media y la mediana, otra medida de tendencia central.
Se observa que la media es mayor que la mediana.
Esto indica una distribución asimétrica de los datos.
Para ver esta asimetría se puede graficar la distribución de frecuencias de esta variable con un histograma (más adelante).

```{r}
res2016 |> 
  summarize(mean(fa), median(fa))
```

También se puede calcular ambas medidas para el FA solo en Cusco.

```{r message=FALSE, warning=FALSE}
res2016 |> 
  filter(dpto =="CUSCO") |>
  summarize(mean(fa), median(fa))
#Cómo calcularían esta media usando la variable "id"?
```

Para describir variables que no son numéricas, podemos producir tablas de distribución de frecuencias.
Por ejemplo, la base de datos incluye una variable de qué partido ganó la mayoría de votos en una provincia.
La variable "gana" de la base de datos recoge este dato.
Podemos usar el comando `count` para calcular la tabla de distribución de frecuencias de esta variable.
Se guarda esta tabla en un objeto "tabla".

Se encuentra que del total de provincias, Fuerza Popular ganó en la mayoría de ellas.

```{r}
tabla = res2016 |>
  count(Ganador = gana, name="Frecuencia")
tabla
```

Para calcular los porcentajes, se puede agregar a la tabla una columna "Porcentaje" con el cálculo de la "Frecuencia" (columna existente) ente la suma total de las frecuencias.
Se encuentra que Fuerza Popular ganó en el 57% de provincias del Perú.

```{r}
tabla = tabla |>
  mutate(Porcentaje = (Frecuencia / sum(Frecuencia)*100 ))
tabla
```

*Pregunta: ¿qué medidas de tendencia central (media, mediana, moda) aplican a qué tipo de variables?*

## Visualización

Una de las tareas más comunes en el manejo de datos es la visualización de los resultados.
En R hay dos maneras de proceder.
La primera es usar los comandos de base de R.
La otra es usar una librería `ggplot2` que permite una mayor flexibilidad en la producción y estética de los gráficos.

Para esto se carga la librería `ggplot2`.
Esta tiene un comando `ggplot` en el que se define los aspectos del gráfico.
Por ejemplo, para graficar una variable numérica, como el porcentaje de voto a FP por provincia, se puede producir un histograma.

Dentro de este comando se define la base de datos y la variable que se va a graficar.
Luego se van agregando capas.
La primera define el tipo de gráfico.
Usamos `geom_histogram` para producir el histograma y se especifica el ancho de columna.
Luego se define las etiquetas de ejes y el tema del gráfico.

Se observa que el gráfico de porcentaje de votos a Fuerza Popular es aproximadamente simétrico, tal como indicaban la similitud entre media y mediana.

```{r message=FALSE, warning=FALSE}
library(ggplot2)
ggplot(res2016, aes(x=fp))+
  geom_histogram(binwidth = 5)+
  xlab("% Voto PPK 2016") +
  ylab("Frecuencia")+
  theme_minimal()
```

Habíamos encontrado que la media y la mediana del porcentaje de voto al Frente Amplio diferían.
Esto lo comprobamos produciendo el histograma de esta variable.

```{r}
ggplot(res2016, aes(x=fa))+
  geom_histogram(binwidth = 5)+
  geom_vline(xintercept = 29.3, color = "red")+
  geom_vline(xintercept = 24.5, color = "green")+
  xlab("% Voto FA 2011")+
  ylab("Frecuencia")+
  theme_classic()
```

Otro gráfico útil en la visualización es el llamado "boxplot" o "gráfico de cajas".
Este tipo de gráficos sirve bastante para comparar entre grupos de otra variable.

Para producir un gráfico de cajas usamos la especificación `geom_bloxplot()` y podemos definir los límites y saltos del eje Y.
Este gráfico nos muestra que el distrito con el menor porcentaje de voto a FP tuvo un poco más de 5% y que el máximo fue de casi 80%.
También muestra que la votación mediana fue de 40%.
Los límites de la caja son el cuartil 25 y el cuartil 75.

```{r}
ggplot(res2016, aes(y=fp))+
  geom_boxplot()+
  ylab("% Voto FP 2011")
```

El aspecto más útil de los gráficos de cajas es la comparación.
Por ejemplo, si se quisiera comparar el voto a Fuerza Popular entre departamentos del país.
Para hacer esto se debe definir que la variable en el eje Y sea el porcentaje de votos a Fuerza Popular "fp" y en el eje X la variable que define los departamentos "dpto".
Incluimos la especificación `coord_flip()` para voltear los ejes y que las etiquetas de los departamentos se lean más claramente.

En el gráfico se pueden hacer varias comparaciones.
Lo más importante es comparar medianas y anchos de cajas entre departamentos.
Los puntos aislados son "outliers" o valores extremos, que se calculan automáticamente y se grafican.

Este gráfico, sin embargo, es muy desagragado.

```{r}
ggplot(res2016, aes(y=fp, x=dpto))+
  geom_boxplot()+
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, 10))+
  ylab("% Voto FP 2011")+
  xlab("Departamento")+
  theme_minimal()+
  coord_flip()
```

Si se quisiera comparar entre regiones (costa, sierre y selva), se tendría que crear esta variable, a partir de la variable "dpto".

Para graficar una variable de tipo cualitativa (o de factor en el lenguaje de R), se debe usar, por ejemplo, un gráfico de barras.
Podemos graficar el porcentaje de provincias que cada partido ganó en 2021.

Para esto seguimos usando la librería `ggplot`, pero ahora no realizaremos un histograma (no usaremos `geom_histogram`), sino barras, con `geom_bar`.
Dentro de este comando se añade `stat="identity` para indicar que R no calcule nada y solo use los datos de "tabla".

```{r}
ggplot(tabla, aes(x=Porcentaje,y=Ganador))+
  geom_bar(stat="identity", width=0.5)
```

## Recodificando variables

```{r}
res2016 = res2016 |>
  mutate(region = case_when(
    dpto=="AMAZONAS"~"Selva",
    dpto=="ANCASH"~"Sierra",
    dpto=="APURIMAC"~"Sierra",
    dpto=="AREQUIPA"~"Sierra",
    dpto=="AYACUCHO"~"Sierra",
    dpto=="CAJAMARCA"~"Sierra",
    dpto=="CUSCO"~"Sierra",
    dpto=="CALLAO"~"Costa",
    dpto=="HUANCAVELICA"~"Sierra",
    dpto=="HUANUCO"~"Selva",
    dpto=="ICA"~"Costa",
    dpto=="JUNIN"~"Sierra",
    dpto=="LA LIBERTAD"~"Costa",
    dpto=="LAMBAYEQUE"~"Costa",
    dpto=="LIMA"~"Costa",
    dpto=="LORETO"~"Selva",
    dpto=="MADRE DE DIOS"~"Selva",
    dpto=="MOQUEGUA"~"Costa",
    dpto=="PASCO"~"Sierra",
    dpto=="PIURA"~"Costa",
    dpto=="PUNO"~"Sierra",
    dpto=="SAN MARTIN"~"Selva",
    dpto=="TACNA"~"Costa",
    dpto=="TUMBES"~"Costa",
    dpto=="UCAYALI"~"Selva"
  )) 
```

```{r}
res2016 |>
  count(Region = region, name="Frecuencia")
```

La variable creada es una variable de tipo "caracter".
En R existe otro tipo de variable llamado "factor".
Podemos convertir cualquier variable a una de factor y etiquetar cada valor.

```{r}
library(forcats)
res2016 = res2016 |>
  mutate(region2 = factor(region))
```

Ahora, procedemos a producir el gráfico de cajas de porcentaje de voto a Fuerza Popular por región.

```{r}
ggplot(res2016, aes(y=fp, x=region))+
  geom_boxplot()+
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, 20))+
  ylab("% Voto FP 2016")+
  xlab("Región")+
  theme_get()
```

Se observa en este gráfico que el voto mediano a Fuerza Popular fue mayor entre provincias de la costa, seguido por la selva y luego la sierra.
Este mismo patrón se observa si calculáramos la media del porcentaje de voto provincial a Fuerza Popular por región.

```{r}
res2016 |> 
  group_by(region2) |>
  summarise(mean(fp), sd(fp))
```

## Medidas de posición

La mediana es un caso particular de las medidas de posición.
Este estadístico divide una distribución ordenada de datos en dos mitades y la mediana es el punto limítrofe entre estos dos grupos.

De la misma manera, los cuartiles dividen una distribución ordenada en 4 partes iguales, y los cuartiles son los valores de los puntos limítrofes.
El gráfico de cajas muestra estos cuartiles, que incluye la mediana.

Para calcular los cuartiles de la distribución general del voto a Fuerza Popular en 2016, se puede usar el comando `summarise` y el estadístico `quantile` del Tidyverse.
Estos comandos también nos retornan el mínimo y máximo.

```{r}
res2016 |> 
  summarise(Cuartiles = quantile(fp))
```

Para calcular los cuartiles del voto a Fuerza Popular en el 2011 por regiones.

```{r}
cuartilesxregion = res2016 |> 
  group_by(region2) |>
  summarise(quantile(fp))
cuartilesxregion
```

## Describiendo la heterogeneidad

El gráfico de cajas también muestra una medida de heterogeneidad: la amplitud de la caja o llamado rango intercuartil.
Mientras más amplia la caja, mayor será la heterogeneidad de los datos, es decir, habrá mayor diferencias entre ellos.
Mientras más estrecha la caja, más homogeneidad, es decir, los datos se parecerán más entre ellos.
Si la caja no tiene amplitud (es decir, es una línea), los datos son completamente homogéneos, es decir, todos iguales.

Formalmente, la amplitud de la caja es la diferencia entre el cuartil 75 y el cuartil 25.
Se puede crear una nueva tabla "ricxregion" con este cálculo.

```{r}
ricxregion = res2016 |>
  group_by(region2) |>
  summarise(IQR(fp))
ricxregion
```

En el gráfico de cajas anterior, se puede decir que el porcentaje de voto provincial a Fuerza Popular es más homogéneo en la selva y más heterogéneo en la sierra.

Otra forma de medir la homogeneidad o heterogeneidad de los datos para una variable numérica es mediante la desviación estándar.
Se puede calcular la desviación estándar de un conjunto de datos numéricos con la función `sd`.
Por ejemplo, para calcular la desviación estándar del voto provincial a Fuerza Popular por región.

```{r}
res2016 |> 
  group_by(region2) |>
  summarise(sd(fp))
```

Encontramos que la región con menor heterogeneidad es la costa, aunque, según esta medida, la región más heterogénea es la selva.
Esto puede ser debido a la presencia de valores atípicos.

------------------------------------------------------------------------

# Comisarias en el Perú

## Medidas de tendencia central

-   Resumen de un conjunto de datos.

-   Se resume mediante un valor "representativo".

-   Cada observación se puede comparar con este valor de resumen.
    Se puede estar por debajo o por encima de este valor.

------------------------------------------------------------------------

## Moda

-   Valor mas frecuente de un conjunto de datos

-   Es apropiada para todo tipo de datos

-   Se puede observar directamente en una tabla de distribución de frecuencias.

Por ejemplo si se mide en cada comisaria del Perú, a cuánta población atiende cada comisaria de acuerdo a la codificación.

![](comi17_pob.png){width="734"}

La base de datos o "dataframe" se vería así

![](comi17_pob2.png)

------------------------------------------------------------------------

Para esta clase se usará la base de datos de comisarias del Perú, que puede ser descargada de la sección microdatos de la web del INEI (ver [aquí](https://proyectos.inei.gob.pe/microdatos/)).
Esta base tiene información para 1495 comisarias y de 281 variables.
Esta base se puede cargar también desde el repositorio Github de este curso.
La base de datos puede ser guardada en el directorio de trabajo.

En primer lugar, se llama a la librería "rio" y se usa el comando `import` que permite leer bases de datos en muchos formatos.

```{r base}
library(rio) 
comi17 = import("bases/comi2017.sav")
```

```{r}
str(comi17$INF109)
class(comi17$INF109)
```

```{r}
library(tidyverse)
library(dplyr)
comi17 = comi17 |>
  mutate(tipo = factor(INF109, labels=c("Menos de 5000 Hab", 
                                        "De 5000 - 10000 Hab", 
                                        "De 10001 - 20000 Hab", 
                                        "De 20001 - 40000 Hab",
                                        "De 40001 a 80000", 
                                        "De 80001 a más")))
```

Esta base de datos incluye a la variable "INF109" (ojo: R es "case sensitive", es decir, diferencia mayúsculas de minúsculas).
La tabla de distribución de frecuencias de esa variable se puede obtener con el siguiente código:

```{r tabla}
tabla1 = comi17 |>
  count(Tipo = tipo, name="Frecuencia")
tabla1
```

En este caso, la moda es el valor más frecuente, que sería el código "2", que significa "De 5,000 a 10,000 hab".

```{r}
tabla1 = comi17 |>
  count(Tipo = tipo, name="Frecuencia") |>
  mutate(Porcentaje = (Frecuencia / sum(Frecuencia)*100 ))
tabla1
```

## Mediana

-   El valor de la observación central de un conjunto de datos ordenados de menor a mayor.

![](mediana1.png){width="497"}

![](mediana2.png){width="498"}

Para calcular la mediana de la variable "INF109" se puede usar el comando `median`.
Este comando internamente ordena los valores de la variable "INF109" de menor a mayor y encuentra el código numérico de la observación que se encuentra en medio de la distribución ordenada.

```{r}
comi17 |>
  summarise(median(INF109))
```

La mediana es el código numérico 3, que significa "De 10,001 a 20,000 hab.".

------------------------------------------------------------------------

## Media

-   Medida más conocida y "útil".

-   Suma del valor de las observaciones dividida entre el número de observaciones

$$
\sum \frac{x_i} {n} = \frac{(x_1 + x_2 +x_3 +...+ x_n)} {n}
$$

En una base de datos, se puede calcular la media sumando los valores de una variable (columna de una base de datos) y dividiendo entre el número de casos (\# total de filas).

![](comi17_media.png){width="258"}

------------------------------------------------------------------------

## Resumen

| TC      | Nominales | Ordinales | Numéricas |
|---------|:---------:|:---------:|:---------:|
| Moda    |    Sí     |    Sí     |    Sí     |
| Mediana |    No     |    Sí     |    Sí     |
| Media   |    No     |    No     |    Sí     |

-   Moda aplica para cualquier tipo de variable, pero menos útil.

-   Media aplica solo para variables numéricas, pero más útil.

------------------------------------------------------------------------

¿Cuál es la media (o el promedio) de policías por comisaria de acuerdo a estos datos?

```{r media}
comi17 |>
  summarise(mean(INF110_TOT))
```

¿Es una representación adecuada de la realidad?
Podemos fijarnos en el gráfico de distribución de esta variable para ver si se tiene comisarias que son "atípicas" de la distribución general.

Esto se puede hacer presentando el histograma de esta variable, que es como un gráfico de barras de una variable numérica.

```{r hist}
library(ggplot2)
ggplot(comi17, aes(x=INF110_TOT))+
  geom_histogram()+
  xlab("Número de efectivos") +
  ylab("Frecuencia")+
  theme_light()
```

¿Qué se puede concluir del gráfico?

```{r mediana}
comi17 |>
  summarise(median(INF110_TOT))
```

¿Qué significa esta diferencia entre la media de 31.6 y la mediana de 19?

```{r resumen}
comi17 |>
  summarise(min(INF110_TOT), median(INF110_TOT), 
            mean(INF110_TOT), max(INF110_TOT))
```

```{r}
ggplot(comi17, aes(x=INF110_TOT))+
  geom_histogram()+
  geom_vline(xintercept = 19, color = "red")+
  geom_vline(xintercept = 31.6, color = "green")+
  xlab("Número de efectivos") +
  ylab("Frecuencia")+
  theme_light()
```

¿Qué se puede comentar de estos datos?

## Medidas de dispersión

-   Describir la centralidad no es suficiente.
    Dos distribuciones pueden tener la misma medida de tendencia central, pero diferentes realidades.

-   Ejemplo: distribución de puntaje en área matemática de prueba PISA aplicada en 2 países pueden tener la misma media, pero diferente variación.

-   ¿Cómo describiría las diferencias entre en los puntajes de la prueba el País A y el País B?

![](distr.png){width="631"}

------------------------------------------------------------------------

## Rango

-   Diferencia entre el valor máximo y el mínimo.
    En ejemplo de policías: 259-3 = 256.
    Es la diferencia entre la comisaría con más efectivos y la comisaría con menor número de efectivos.

-   No un una medida muy útil.

------------------------------------------------------------------------

## Rango intercuartil

-   Se verá cuando se vean percentiles.

------------------------------------------------------------------------

## Desviación estándar

-   Cada observación está a una "distancia" de la media.
    Esta distancia se llama desviación $(x_i-\bar{x})$

-   Observaciones por encima de la media tendrán desviaciones positivas.
    Observaciones por debajo de la media tendrán desviaciones negativas.

-   No se puede calcular un promedio de desviaciones porque valores positivos se cancelan con negativos.

-   Se eleva al cuadrado las observaciones para que todas sean positivas.
    Se promedian esas desviaciones al cuadrado.

-   La desviación estándar es la raíz cuadrada de ese promedio de desviaciones al cuadrado.

-   Se divide entre n-1 por un tema técnico.

$$
\sum \frac{(x_i-\bar{x})^2} {n-1} 
$$

Para ver un cálculo básico de la desviación estándar en Excel, puede entrar [aquí](https://docs.google.com/spreadsheets/d/1CCzOtfXf7Igz_KcbcpItzU71fWeMtTli?rtpof=true&authuser=arturo.maldonado%40pucp.pe&usp=drive_fs).

-   Como se observa en el gráfico anterior, la desviación estándar es más útil cuando se comparar dos distribuciones. Se compara la centralidad y la dispersión de una variable entre dos grupos (o dos distribuciones).

```{r}
comi17 |>
  summarise(sd(INF110_TOT))
```

Siguiendo con la base de datos de comisarías del Perú, queremos evaluar si el número de policías (INF110_TOT) aumenta a medida que la comisaría atienda a una población mayor (INF109).

Como se vio antes, la variable de población a la que atiende está codificada en 6 grupos, desde 1 que significa "Menos de 5000 hab" a 6 que significa "De 80000 a más hab".

```{r tablapob}
tabla1
```

Lo que se quiere calcular es el promedio y la desviación estándar de policías por cada grupo de población a la que atiende.
Esta operación se puede hacer de múltiples maneras en R.

```{r mediagrupos}
comi17 |>
  group_by(tipo) |>
  summarise(mean(INF110_TOT))
```

Efectivamente, como se esperaba, el número promedio de policías aumenta a medida que la comisaría atiende a una población mayor.

También se puede comparar la desviación estándar en cada grupo.
El comando para el cálculo de la desviación estándar es `sd`.

```{r desvgrupos}
mediaxtipo = comi17 |>
  group_by(Tipo = tipo) |>
  summarise(Media = mean(INF110_TOT), Desv = sd(INF110_TOT))
mediaxtipo
```

La desviación estándar también aumenta a medida que las comisarías atienden a una población mayor.
Es decir, las comisarías que atienden a una población pequeña son más homogéneas que las que atienden a una población mayor, donde hay mayores diferencias en el número de efectivos entre comisarías.

¿A qué puede deberse este resultado?
Una posible explicación es la complejidad de ciudades más grandes, por lo que podría requerir comisarias especializadas, además de las comisarias estándar.
Por el contrario, centros urbanos más pequeños solo requerirían comisarías pequeñas.

En R hay diferentes maneras de hacer lo mismo.
Para los gráficos existe una librería especializada llamada `ggplot2`.
Con esa librería se tiene más opciones gráficas que con los comandos de base.
También existe una forma de codificación llamado `tidyverse` que usa el operador `%>%`.
Aquí se presenta un ejemplo que produce el histograma del número de policías por cada grupo de tamaño de población.

```{r histgrupos}
library(ggplot2)
library(dplyr)
comi17 |>
  ggplot(aes(x=INF110_TOT))+
  geom_histogram()+
  facet_wrap(~tipo)+
  xlab("Número de policías")+
  ylab("Frecuencia")
```

¿Qué otras preguntas se pueden responder con los datos de comisarías?

```{r}
ggplot(mediaxtipo, aes(x=Tipo, y=Media)) + 
  geom_bar(stat = "identity") +
  ggtitle("Número de efectivos promedio por tipo de comisaría") +
  xlab("Tipo de comisaría") +
  geom_text(aes(label=round(Media,1)), vjust=1.30, color="white", size=3)+
  theme_minimal()
```

Otra forma de describir descriptivamente esta variable mediante un gráfico es mediante el gráfico de cajas o "boxplot".
Este gráfico muestra el mínimo, los cuartiles y el máximo.
Los cuartiles dividen el número de observaciones en cuatro grupos de igual tamaño, aunque sus límites difieren.
El segundo cuartil es la mediana.

```{r}
ggplot(comi17, aes(y=INF110_TOT, x=tipo))+
  geom_boxplot()+
  scale_y_continuous(limits = c(0, 300), breaks = seq(0, 300, 50))+
  ylab("Número de efectivos")+
  xlab("Tipo de comisaría")+
  theme_get()
```

------------------------------------------------------------------------

Se pueden calcular los cuartiles para toda la distribución con el comando `quantile`.
Estos datos muestran que entre el 25% de todas las comisarías tienen entre 3 y 11 efectivos.
El segundo 25% de comisarías tiene entre 11 y 19 efectivos.
El tercer 25% tiene entre 19 7 37 efectivos, y el último 25% tiene entre 37 y 259 efectivos.

```{r}
comi17 |> 
  summarise(Cuartiles = quantile(INF110_TOT))
```

Los cuartiles también se pueden calcular por tipo de comisaría.
Este código nos muestra los cuartiles por tipo de comisaría en cada fila.

```{r}
cuartilesxtipo = comi17 |> 
  group_by(tipo) |>
  summarise(quantile(INF110_TOT))
cuartilesxtipo
```

El ancho de cada caja es un estadístico de dispersión.
Este estadístico se llama rango intercuartil y formalmente es la resta del cuartil 75 menos el cuartil 25.

La tabla nos muestra los dos estadísticos de dispersión, el rango intercuartil y la desviación estándar.
Para comparar entre grupos se puede comparar medianas contra medianas y rangos intercuartiles.
Esto se puede hacer en un gráfico de cajas.
Otra forma de comparar es medias contra medias y desviaciones estándar por grupo.

```{r}
ricxtipo = comi17 |>
  group_by(tipo) |>
  summarise(Media= mean(INF110_TOT), Desv.Estd = sd(INF110_TOT), 
            Mediana = median(INF110_TOT), RIC= IQR(INF110_TOT))
ricxtipo
```

Regularmente ambas comparaciones son consistentes.

## Descripción de variable de tipo factor

```{r}
library(rio) 
comi17_2 = import("bases/comi2017_2.sav")
```

```{r}
comi17_2 = comi17_2 |>
  mutate(agua = recode(INF264_A, '1' = '1', '2' = '1', '3' = '1', '4' = '0'))
```

```{r}
comi17_2 = comi17_2 |>
  mutate(luz = recode(INF264_B, '1' = '1', '2' = '1', '3' = '1', '4' = '0'))
```

```{r}
comi17_2 = comi17_2 |>
  mutate(telefono = recode(INF264_C, '1' = '1', '2' = '1', '3' = '1', '4' = '0'))
```

```{r}
comi17_2 = comi17_2 |>
  mutate(internet = recode(INF264_E, '1' = '1', '2' = '1', '3' = '1', '4' = '0'))
```

```{r}
comi17_2 = comi17_2 |>
  mutate(internet = factor(internet, labels=c("No", "Sí")))
```

```{r}
tabla2 = comi17_2 |>
  count(Tiene = internet, name="Frecuencia") |>
  mutate(Porcentaje = (Frecuencia / sum(Frecuencia)*100 ))
tabla2
```

```{r}
ggplot(tabla2, aes(x=Tiene, y=Porcentaje)) + 
  geom_bar(stat = "identity") +
  ggtitle("Comisaría tiene internet") +
  xlab("Cuenta con servicio de internet") +
  geom_text(aes(label=round(Porcentaje,1)), vjust=1.30, color="white", size=3)+
  theme_minimal()
```

# Bibliografía
